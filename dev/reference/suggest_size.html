<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><!-- upstream: inst/BS5/templates/head.html; pkgdown-version: 2.1.3, fe04924 --><!-- https://github.com/r-lib/pkgdown/tree/fe04924b3df129bea60ac871614b01d87bcae147 --><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Suggest submodel size — suggest_size • projpred</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_3-0.4.10/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- Font Awesome 7.0.1 for Bluesky icon --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" referrerpolicy="no-referrer"><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Suggest submodel size — suggest_size"><meta name="description" content='This function can suggest an appropriate submodel size based on a decision
rule described in section "Details" below. Note that this decision is quite
heuristic and should be interpreted with caution. It is recommended to
examine the results via plot.vsel(), cv_proportions(),
plot.cv_proportions(), and/or summary.vsel() and to make the final
decision based on what is most appropriate for the problem at hand.'><meta property="og:description" content='This function can suggest an appropriate submodel size based on a decision
rule described in section "Details" below. Note that this decision is quite
heuristic and should be interpreted with caution. It is recommended to
examine the results via plot.vsel(), cv_proportions(),
plot.cv_proportions(), and/or summary.vsel() and to make the final
decision based on what is most appropriate for the problem at hand.'><meta property="og:image" content="https://mc-stan.org/projpred/logo.svg"><meta name="robots" content="noindex"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <!-- upstream: inst/BS5/templates/navbar.html; pkgdown-version: 2.1.3, fe04924 -->
<!-- https://github.com/r-lib/pkgdown/tree/fe04924b3df129bea60ac871614b01d87bcae147 -->
<nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">


    <a class="navbar-brand me-2" href="../index.html">
      <!-- Add Stan logo -->
      <picture><source type="image/svg+xml" srcset="../logo.svg"><img src="../logo.png" class="stan-logo" alt="Stan blue hex logo"></source></picture>
      projpred
    </a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">2.9.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html" aria-label="Go to homepage"><span class="fa fa-home fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../articles/index.html">Vignettes</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-other-packages" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Other Packages</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-other-packages"><li><a class="external-link dropdown-item" href="https://mc-stan.org/bayesplot">bayesplot</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/cmdstanr">cmdstanr</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/loo">loo</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/posterior">posterior</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/rstan">rstan</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/rstanarm">rstanarm</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/rstantools">rstantools</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/shinystan">shinystan</a></li>
  </ul></li>
<li class="nav-item"><a class="external-link nav-link" href="https://mc-stan.org/about/">About Stan</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://bsky.app/profile/did:plc:qznndgdnkem2yryu7ipqbpv7" aria-label="Visit our Bluesky profile"><span class="fa fa-brands fa-bluesky"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://discourse.mc-stan.org/" aria-label="Visit our forums"><span class="fa fa-users"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/stan-dev/projpred/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Suggest submodel size</h1>
      <small class="dont-index">Source: <a href="https://github.com/stan-dev/projpred/blob/master/R/methods.R" class="external-link"><code>R/methods.R</code></a></small>
      <div class="d-none name"><code>suggest_size.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function can suggest an appropriate submodel size based on a decision
rule described in section "Details" below. Note that this decision is quite
heuristic and should be interpreted with caution. It is recommended to
examine the results via <code><a href="plot.vsel.html">plot.vsel()</a></code>, <code><a href="cv_proportions.html">cv_proportions()</a></code>,
<code><a href="plot.cv_proportions.html">plot.cv_proportions()</a></code>, and/or <code><a href="summary.vsel.html">summary.vsel()</a></code> and to make the final
decision based on what is most appropriate for the problem at hand.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">suggest_size</span><span class="op">(</span><span class="va">object</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'vsel'</span></span>
<span><span class="fu">suggest_size</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  stat <span class="op">=</span> <span class="st">"elpd"</span>,</span>
<span>  pct <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"upper"</span>,</span>
<span>  thres_elpd <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  warnings <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-object">object<a class="anchor" aria-label="anchor" href="#arg-object"></a></dt>
<dd><p>An object of class <code>vsel</code> (returned by <code><a href="varsel.html">varsel()</a></code> or
<code><a href="cv_varsel.html">cv_varsel()</a></code>).</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Arguments passed to <code><a href="summary.vsel.html">summary.vsel()</a></code>, except for <code>object</code>, <code>stats</code>
(which is set to <code>stat</code>), <code>type</code>, and <code>deltas</code> (which is set to <code>TRUE</code>).
See section "Details" below for some important arguments which may be
passed here.</p></dd>


<dt id="arg-stat">stat<a class="anchor" aria-label="anchor" href="#arg-stat"></a></dt>
<dd><p>Performance statistic (i.e., utility or loss) used for the
decision. See argument <code>stats</code> of <code><a href="summary.vsel.html">summary.vsel()</a></code> and <code><a href="plot.vsel.html">plot.vsel()</a></code> for
possible choices.</p></dd>


<dt id="arg-pct">pct<a class="anchor" aria-label="anchor" href="#arg-pct"></a></dt>
<dd><p>A number giving the proportion (<em>not</em> percents) of the <em>relative</em>
null model utility one is willing to sacrifice. See section "Details" below
for more information.</p></dd>


<dt id="arg-type">type<a class="anchor" aria-label="anchor" href="#arg-type"></a></dt>
<dd><p>Either <code>"upper"</code> or <code>"lower"</code> determining whether the decision is
based on the upper or lower uncertainty interval bound, respectively. See
section "Details" below for more information.</p></dd>


<dt id="arg-thres-elpd">thres_elpd<a class="anchor" aria-label="anchor" href="#arg-thres-elpd"></a></dt>
<dd><p>Only relevant if <code>stat %in% c("elpd", "mlpd", "gmpd"))</code>.
The threshold for the ELPD difference (taking the submodel's ELPD minus the
baseline model's ELPD) above which the submodel's ELPD is considered to be
close enough to the baseline model's ELPD. An equivalent rule is applied in
case of the MLPD and the GMPD. See section "Details" for a formalization.
Supplying <code>NA</code> deactivates this.</p></dd>


<dt id="arg-warnings">warnings<a class="anchor" aria-label="anchor" href="#arg-warnings"></a></dt>
<dd><p>Mainly for internal use. A single logical value indicating
whether to throw warnings if automatic suggestion fails. Usually there is
no reason to set this to <code>FALSE</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A single numeric value, giving the suggested submodel size (or <code>NA</code>
if the suggestion failed).</p>
<p>The intercept is not counted by <code>suggest_size()</code>, so a suggested size of
zero stands for the intercept-only model.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>In general (beware of special cases below), the suggested model
size is the smallest model size \(j \in \{0, 1, ...,
  \texttt{nterms\_max}\}\) for which either the
lower or upper bound (depending on argument <code>type</code>) of the uncertainty
interval (with nominal coverage <code>1 - alpha</code>; see argument <code>alpha</code> of
<code><a href="summary.vsel.html">summary.vsel()</a></code>) for \(U_j - U_{\mathrm{base}}\) (with
\(U_j\) denoting the \(j\)-th submodel's true utility and
\(U_{\mathrm{base}}\) denoting the baseline model's true utility)
falls above (or is equal to) $$\texttt{pct} \cdot (u_0 -
  u_{\mathrm{base}})$$ where \(u_0\) denotes the null
model's estimated utility and \(u_{\mathrm{base}}\) the baseline
model's estimated utility. The baseline model is either the reference model
or the best submodel found (see argument <code>baseline</code> of <code><a href="summary.vsel.html">summary.vsel()</a></code>).</p>
<p>In doing so, loss statistics like the root mean squared error (RMSE) and
the mean squared error (MSE) are converted to utilities by multiplying them
by <code>-1</code>, so a call such as <code>suggest_size(object, stat = "rmse", type = "upper")</code> finds the smallest model size whose upper uncertainty interval
bound for the <em>negative</em> RMSE or MSE exceeds (or is equal to) the cutoff
(or, equivalently, has the lower uncertainty interval bound for the RMSE or
MSE below—or equal to—the cutoff). This is done to make the
interpretation of argument <code>type</code> the same regardless of argument <code>stat</code>.</p>
<p>For the geometric mean predictive density (GMPD), the decision rule above
is applied on <code><a href="https://rdrr.io/r/base/Log.html" class="external-link">log()</a></code> scale. In other words, if the true GMPD is denoted by
\(U^\ast_j\) for the \(j\)-th submodel and
\(U^\ast_{\mathrm{base}}\) for the baseline model (so that
\(U_j\) and \(U_{\mathrm{base}}\) from above are given by
\(U_j = \log(U^\ast_j)\) and
\(U_{\mathrm{base}} = \log(U^\ast_{\mathrm{base}})\)), then <code>suggest_size()</code> yields the smallest model size whose
lower or upper (depending on argument <code>type</code>) uncertainty interval bound
for \(\frac{U^\ast_j}{U^\ast_{\mathrm{base}}}\) exceeds
(or is equal to)
$$(\frac{u^\ast_0}{u^\ast_{\mathrm{base}}})^{\texttt{pct}}$$ where \(u^\ast_0\) denotes the null
model's estimated GMPD and \(u^\ast_{\mathrm{base}}\) the
baseline model's estimated GMPD.</p>
<p>If <code>!is.na(thres_elpd)</code> and <code>stat = "elpd"</code>, the decision rule above is
extended: The suggested model size is then the smallest model size \(j\)
fulfilling the rule above <em>or</em> \(u_j - u_{\mathrm{base}} &gt;
  \texttt{thres\_elpd}\). Correspondingly, in case
of <code>stat = "mlpd"</code> (and <code>!is.na(thres_elpd)</code>), the suggested model size is
the smallest model size \(j\) fulfilling the rule above <em>or</em> \(u_j -
  u_{\mathrm{base}} &gt; \frac{\texttt{thres\_elpd}}{N}\) with \(N\) denoting the number of observations.
Correspondingly, in case of <code>stat = "gmpd"</code> (and <code>!is.na(thres_elpd)</code>), the
suggested model size is the smallest model size \(j\) fulfilling the rule
above <em>or</em> \(\frac{u^\ast_j}{u^\ast_{\mathrm{base}}} &gt;
  \exp(\frac{\texttt{thres\_elpd}}{N})\).</p>
<p>For example (disregarding the special extensions in case of
<code>!is.na(thres_elpd)</code> with <code>stat %in% c("elpd", "mlpd", "gmpd")</code>), <code>alpha = 2 * pnorm(-1)</code>, <code>pct = 0</code>, and <code>type = "upper"</code> means that we select the
smallest model size for which the upper bound of the <code>1 - 2 * pnorm(-1)</code>
(approximately 68.3 %) uncertainty interval for \(U_j -
  U_{\mathrm{base}}\)
(\(\frac{U^\ast_j}{U^\ast_{\mathrm{base}}}\) in case of
the GMPD) exceeds (or is equal to) zero (one in case of the GMPD), that is
(if <code>stat</code> is a performance statistic for which a normal-approximation
uncertainty interval is used, see argument <code>stats</code> of <code><a href="summary.vsel.html">summary.vsel()</a></code> and
<code><a href="plot.vsel.html">plot.vsel()</a></code>), for which the submodel's utility estimate is at most one
standard error smaller than the baseline model's utility estimate (with
that standard error referring to the utility <em>difference</em>).</p>
<p>Apart from the two <code><a href="summary.vsel.html">summary.vsel()</a></code> arguments mentioned above (<code>alpha</code> and
<code>baseline</code>), <code>resp_oscale</code> is another important <code><a href="summary.vsel.html">summary.vsel()</a></code> argument
that may be passed via <code>...</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Data:</span></span></span>
<span class="r-in"><span><span class="va">dat_gauss</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">df_gaussian</span><span class="op">$</span><span class="va">y</span>, <span class="va">df_gaussian</span><span class="op">$</span><span class="va">x</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The `stanreg` fit which will be used as the reference model (with small</span></span></span>
<span class="r-in"><span><span class="co"># values for `chains` and `iter`, but only for technical reasons in this</span></span></span>
<span class="r-in"><span><span class="co"># example; this is not recommended in general):</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">rstanarm</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstanarm/reference/stan_glm.html" class="external-link">stan_glm</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">y</span> <span class="op">~</span> <span class="va">X1</span> <span class="op">+</span> <span class="va">X2</span> <span class="op">+</span> <span class="va">X3</span> <span class="op">+</span> <span class="va">X4</span> <span class="op">+</span> <span class="va">X5</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian</a></span><span class="op">(</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">dat_gauss</span>,</span></span>
<span class="r-in"><span>  QR <span class="op">=</span> <span class="cn">TRUE</span>, chains <span class="op">=</span> <span class="fl">2</span>, iter <span class="op">=</span> <span class="fl">500</span>, refresh <span class="op">=</span> <span class="fl">0</span>, seed <span class="op">=</span> <span class="fl">9876</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Run varsel() (here without cross-validation, with L1 search, and with small</span></span></span>
<span class="r-in"><span><span class="co"># values for `nterms_max` and `nclusters_pred`, but only for the sake of</span></span></span>
<span class="r-in"><span><span class="co"># speed in this example; this is not recommended in general):</span></span></span>
<span class="r-in"><span><span class="va">vs</span> <span class="op">&lt;-</span> <span class="fu"><a href="varsel.html">varsel</a></span><span class="op">(</span><span class="va">fit</span>, method <span class="op">=</span> <span class="st">"L1"</span>, nterms_max <span class="op">=</span> <span class="fl">3</span>, nclusters_pred <span class="op">=</span> <span class="fl">10</span>,</span></span>
<span class="r-in"><span>             seed <span class="op">=</span> <span class="fl">5555</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu">suggest_size</span><span class="op">(</span><span class="va">vs</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 3</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Juho Piironen, Markus Paasiniemi, Alejandro Catalina, Frank Weber, Osvaldo Martin, Aki Vehtari.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

